library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/Dataset.xlsx")
dim(Dataset)
library(DataExplorer)
# Visualization
plot_missing (Dataset)
table(AgeCategory, waiting)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/Dataset.xlsx")
dim(Dataset)
head(Dataset)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
dim(DatasetNew)
head(DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/Dataset.xlsx")
dim(Dataset)
head(Dataset)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
dim(DatasetNew)
head(DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
dim(DatasetNew)
head(DatasetNew)
library(DataExplorer)
# Visualization
plot_missing (DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
Dataset <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
dim(DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
DatasetNew <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
dim(DatasetNew)
head(DatasetNew)
library(DataExplorer)
# Visualization
plot_missing (DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
DatasetNew <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
# Exclude the unwanted column named '...4'
DatasetNew <- DatasetNew %>%
select(-`...3`)
#Explore number of rows and # columns
dim(DatasetNew)
#look at structure
str(DatasetNew)
library(DataExplorer)
# Visualization
plot_missing (DatasetNew)
table(AgeCategory, waiting)
table(AgeCategory, waiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(AgeCategory, waiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(DatasetNewAgeCategory, DatasetNewwaiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- TableAgeCat[, c(2,1)]
TableAgeCat
TotalN <- sum(TableAgeCat)
TotalPropTableAgeCat <- (TableAgeCat / TotalN) * 100
TotalPropTableAgeCat
chisq.test(TableAgeCat)
table(visits, waiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- TableAgeCat[, c(2,1)]
TableAgeCat
TotalN <- sum(TableAgeCat)
TotalPropTableAgeCat <- (TableAgeCat / TotalN) * 100
TotalPropTableAgeCat
chisq.test(TableAgeCat)
table(DatasetNew$visits, DatasetNew$waiting)
TableVisit <-table(DatasetNew$visits,DatasetNew$ waiting)
TableVisit <-TableVisit[, c(2,1)]
TableVisit
TotalN <- sum(TableVisit)
TotalPropTableVisit <- (TableVisit / TotalN) * 100
TotalPropTableVisit
chisq.test(TableVisit)
table(location, waiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- TableAgeCat[, c(2,1)]
TableAgeCat
TotalN <- sum(TableAgeCat)
TotalPropTableAgeCat <- (TableAgeCat / TotalN) * 100
TotalPropTableAgeCat
chisq.test(TableAgeCat)
table(DatasetNew$visits, DatasetNew$waiting)
TableVisit <-table(DatasetNew$visits,DatasetNew$ waiting)
TableVisit <-TableVisit[, c(2,1)]
TableVisit
TotalN <- sum(TableVisit)
TotalPropTableVisit <- (TableVisit / TotalN) * 100
TotalPropTableVisit
chisq.test(TableVisit)
table(DatasetNew$location, DatasetNew$waiting)
TableLocation<-table(DatasetNew$location, DatasetNew$waiting)
TableLocation
TableLocation <-TableLocation[, c(2,1)]
TableLocation
TotalN <- sum(TableLocation)
TotalPropTableLocation <- (TableLocation / TotalN) * 100
TotalPropTableLocation
chisq.test(TableLocation)
table(Gender, waiting)
table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- table(DatasetNew$AgeCategory, DatasetNew$waiting)
TableAgeCat <- TableAgeCat[, c(2,1)]
TableAgeCat
TotalN <- sum(TableAgeCat)
TotalPropTableAgeCat <- (TableAgeCat / TotalN) * 100
TotalPropTableAgeCat
chisq.test(TableAgeCat)
table(DatasetNew$visits, DatasetNew$waiting)
TableVisit <-table(DatasetNew$visits,DatasetNew$ waiting)
TableVisit <-TableVisit[, c(2,1)]
TableVisit
TotalN <- sum(TableVisit)
TotalPropTableVisit <- (TableVisit / TotalN) * 100
TotalPropTableVisit
chisq.test(TableVisit)
table(DatasetNew$location, DatasetNew$waiting)
TableLocation<-table(DatasetNew$location, DatasetNew$waiting)
TableLocation
TableLocation <-TableLocation[, c(2,1)]
TableLocation
TotalN <- sum(TableLocation)
TotalPropTableLocation <- (TableLocation / TotalN) * 100
TotalPropTableLocation
chisq.test(TableLocation)
table(DatasetNew$Gender,DatasetNew$waiting)
TableGender<-table(DatasetNew$Gender, DatasetNew$waiting)
TableGender
TableGender <-TableGender[, c(2,1)]
TableGender
chisq.test(TableGender)
table(DatasetNew$Hospitalgrp, DatasetNew$waiting)
TableHosp<-table(DatasetNew$Hospitalgrp, DatasetNew$waiting)
TableHosp
TableHosp <-TableHosp[, c(2,1)]
TableHosp
TotalN <- sum(TableHosp)
TotalPropTableHosp <- (TableHosp / TotalN) * 100
TotalPropTableHosp
chisq.test(TableHosp)
table(DatasetNew$Province, DatasetNew$waiting)
TableProv <-table(DatasetNew$Province, DatasetNew$waiting)
TableProv
TableProv <-TableProv[, c(2,1)]
TableProv
chisq.test(TableProv)
###location##
DatasetNew$location <- as.factor(DatasetNew$location)
levels(DatasetNew$location)  # Confirm levels (should show "Adult" and "young")
DatasetNew$waiting <- ifelse(DatasetNew$waiting == "Yes", 1,
ifelse(DatasetNew$waiting == "No", 0, NA))  # Convert to 0/1
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
levels(DatasetNew$waiting)  # Ensure only two levels exist (0 and 1)
MOD1 <- glm(waiting ~ location, family = "binomial", data = DatasetNew)
summary(MOD1)
exp(-0.3633)
exp(confint(MOD1))
MOD2<- glm(waiting ~ location + AgeCategory + visits + Gender, family = "binomial", data = DatasetNew)
summary(MOD2)
anova(MOD1, MOD2)   ## Model2 is better and statistically significant
MOD3<- glm(waiting ~ location + AgeCategory + Gender, family = "binomial", data = DatasetNew)
summary(MOD3)
anova(MOD2, MOD3)   ### removing visits does not improve the model and it is not statistically significant. The final model remains MODEL 2 with Agecat, visits and Gender
MOD2<- glm(waiting ~ location + AgeCategory + visits + Gender, family = "binomial", data = DatasetNew)
summary(MOD2)
exp(-0.4310 )
exp(confint(MOD2))
##Hospitalgrp##
DatasetNew$Hospitalgrp <- as.factor(DatasetNew$Hospitalgrp)
levels(DatasetNew$Hospitalgrp)  # Confirm levels (should show "Adult" and "young")
DatasetNew$waiting <- ifelse(DatasetNew$waiting == "Yes", 1,
ifelse(DatasetNew$waiting == "No", 0, NA))  # Convert to 0/1
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
levels(DatasetNew$waiting)  # Ensure only two levels exist (0 and 1)
MOD4 <- glm(waiting ~ Hospitalgrp, family = "binomial", data = DatasetNew)
MOD4 <- glm(waiting ~ Hospitalgrp, family = "binomial", data = DatasetNew)
###location##
DatasetNew$location <- as.factor(DatasetNew$location)
levels(DatasetNew$location)  # Confirm levels (should show "Adult" and "young")
DatasetNew$waiting <- ifelse(DatasetNew$waiting == "Yes", 1,
ifelse(DatasetNew$waiting == "No", 0, NA))  # Convert to 0/1
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
levels(DatasetNew$waiting)  # Ensure only two levels exist (0 and 1)
MOD1 <- glm(waiting ~ location, family = "binomial", data = DatasetNew)
###location##
DatasetNew$location <- as.factor(DatasetNew$location)
levels(DatasetNew$location)  # Confirm levels (should show "Adult" and "young")
DatasetNew$waiting <- ifelse(DatasetNew$waiting == "Yes", 1,
ifelse(DatasetNew$waiting == "No", 0, NA))  # Convert to 0/1
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
levels(DatasetNew$waiting)  # Ensure only two levels exist (0 and 1)
MOD1 <- glm(waiting ~ location, family = "binomial", data = DatasetNew)
table(DatasetNew$location)
# 1. Convert variables to factors
# Convert location to a factor (necessary for proper contrasts)
DatasetNew$location <- as.factor(DatasetNew$location)
# Convert the outcome 'waiting' to a factor
# This is crucial for binomial regression
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
# Optional: Check the levels of the outcome to ensure it is binary (e.g., Yes/No)
# The first level will be the reference (baseline) group.
levels(DatasetNew$waiting)
table(DatasetNew$location)
# 1. Convert variables to factors
# Convert location to a factor (necessary for proper contrasts)
DatasetNew$location <- as.factor(DatasetNew$location)
# Convert the outcome 'waiting' to a factor
# This is crucial for binomial regression
DatasetNew$waiting <- as.factor(DatasetNew$waiting)
# Optional: Check the levels of the outcome to ensure it is binary (e.g., Yes/No)
# The first level will be the reference (baseline) group.
levels(DatasetNew$waiting)
# 2. Run the Logistic Regression (GLM with binomial family)
MOD1 <- glm(
waiting ~ location,
family = "binomial", # Specifies logistic regression
data = DatasetNew
)
table(DatasetNew$waiting)
levels(DatasetNew$location)
levels(DatasetNew$waiting)
str(DatasetNew)
library(readxl)
library(dplyr) # Must load dplyr to use select()
DatasetNew <- read_excel("/Users/corneille/Desktop/Datasets/DatasetNew.xlsx")
# Exclude the unwanted column named '...4'
DatasetNew <- DatasetNew %>%
select(-`...3`)
#Explore number of rows and # columns
dim(DatasetNew)
#look at structure
str(DatasetNew)
varset <-
c(
'Province', 'visits', 'AgeCategory',
'Hospitalgrp', 'location', 'Gender', 'entrance', 'triage', 'medical doctor', 'laboratory', 'dispensing pharmacy', 'radiolohgy',
'rights respected?'
)
# Load necessary packages
library(dplyr)
library(tidyr)
# 1. Define the set of variables to keep and check for completeness
varset <- c(
'Province', 'visits', 'AgeCategory', 'Hospitalgrp', 'location', 'Gender',
'entrance', 'triage', 'medical doctor', 'laboratory', 'dispensing pharmacy',
'radiolohgy', 'rights respected?'
)
# 2. Select the variables and convert character "NA" to R's NA
# This is crucial because your missing values are character strings.
DatasetTemp <- DatasetNew %>%
# Select only the columns needed for the analysis
select(all_of(varset)) %>%
# Replace all character "NA" strings with the R missing value NA.
# across() applies the replacement to all selected columns.
mutate(across(everything(), ~na_if(.x, "NA")))
# 3. Create the final 'analytic.data' by removing all rows with NA in the selected columns
# drop_na() removes rows where ANY of the listed columns have an NA value.
analytic.data <- DatasetTemp %>%
drop_na()
# 4. (Optional) Check the dimensions to see how many rows were dropped
cat("Original rows:", nrow(DatasetNew), "\n")
cat("Rows in analytic.data (complete cases):", nrow(analytic.data), "\n")
# Load necessary packages
library(dplyr)
library(tidyr)
# 1. Define the set of variables to keep and check for completeness
varset <-
c(
'Province', 'visits', 'AgeCategory',
'Hospitalgrp', 'location', 'Gender', 'entrance', 'triage', 'medical doctor', 'laboratory', 'dispensing pharmacy', 'radiolohgy',
'rights respected?'
)
# 2. Select the variables and convert character "NA" to R's NA
# This is crucial because your missing values are character strings.
DatasetTemp <- DatasetNew %>%
# Select only the columns needed for the analysis
select(all_of(varset)) %>%
# Replace all character "NA" strings with the R missing value NA.
# across() applies the replacement to all selected columns.
mutate(across(everything(), ~na_if(.x, "NA")))
# 3. Create the final 'analytic.data' by removing all rows with NA in the selected columns
# drop_na() removes rows where ANY of the listed columns have an NA value.
analytic.data <- DatasetTemp %>%
drop_na()
# 4. (Optional) Check the dimensions to see how many rows were dropped
cat("Original rows:", nrow(DatasetNew), "\n")
cat("Rows in analytic.data (complete cases):", nrow(analytic.data), "\n")
library(dplyr)
analytic.data <- DatasetNew %>%
select(all_of(varset)) %>%      # keep only the variables in varset
filter(complete.cases(.))       # keep only complete cases
library(dplyr)
analytic.data <- DatasetNew %>%
select(all_of(varset)) %>%      # keep only the variables in varset
filter(complete.cases(.))       # keep only complete cases
dim(analytic.data)
# Load necessary packages
library(dplyr)
library(tidyr)
# 1. Define the set of variables to keep and check for completeness
varset <-
c(
'Province', 'visits', 'AgeCategory',
'Hospitalgrp', 'location', 'Gender', 'entrance', 'triage', 'medical doctor', 'laboratory', 'dispensing pharmacy', 'radiolohgy',
'rights respected?'
)
library(dplyr)
analytic.data <- DatasetNew %>%
select(all_of(varset)) %>%      # keep only the variables in varset
filter(complete.cases(.))       # keep only complete cases
dim(analytic.data)
str(analytic.data)
#Recode Yes/No to 1/0
yes_no_vars <- c(
"entrance",
"triage",
"medical doctor",
"laboratory",
"dispensing pharmacy",
"radiolohgy",
"rights respected?"
)
analytic.data <- analytic.data %>%
mutate(across(all_of(yes_no_vars),
~ case_when(
. == "Yes" ~ 1,
. == "No"  ~ 0,
TRUE       ~ NA_real_
)))
str(analytic.data)
table(analytic.data$Province)
table(analytic.data$visits
)
> table(analytic.data$visits
table(analytic.data$AgeCategory)
table(analytic.data$ Hospitalgrp)
table(analytic.data$location)
table(analytic.data$Gender
)
#Recode Yes/No to 1/0
yes_no_vars <- c(
"entrance",
"triage",
"medical doctor",
"laboratory",
"dispensing pharmacy",
"radiolohgy",
"rights respected?"
)
analytic.data <- analytic.data %>%
mutate(across(all_of(yes_no_vars),
~ case_when(
. == "Yes" ~ 1,
. == "No"  ~ 0,
TRUE       ~ NA_real_
)))
analytic.data <- analytic.data %>%
mutate(
Province = recode(Province,
"Eastern"      = 1,
"Kigali City"  = 2,
"Northern"     = 3,
"Southern"     = 4,
"Western"      = 5) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
visits = recode(visits,
"new"        = 1,
"returning" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
AgeCategory = recode(AgeCategory,
"young" = 1,
"Adult" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
Hospitalgrp = recode(Hospitalgrp,
"District"     = 1,
"higherRanked" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
location = recode(location,
"rural" = 1,
"urban" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
Gender = recode(Gender,
"Male"   = 1,
"Female" = 2) |> as.numeric()
)
lapply(analytic.data[, c("Province", "visits", "AgeCategory",
"Hospitalgrp", "location", "Gender")], table)
MOD1 <- glm(waiting ~ location, family = "binomial", data = DatasetNew)
str(DatasetNew)
# Load necessary packages
library(dplyr)
library(tidyr)
# 1. Define the set of variables to keep and check for completeness
varset <-
c(
'Province', 'visits', 'AgeCategory',
'Hospitalgrp', 'location', 'Gender', 'entrance', 'triage', 'medical doctor', 'laboratory', 'dispensing pharmacy', 'radiolohgy','rights respected?', 'waiting' , 'cashier'
)
library(dplyr)
analytic.data <- DatasetNew %>%
select(all_of(varset)) %>%      # keep only the variables in varset
filter(complete.cases(.))       # keep only complete cases
dim(analytic.data)
#Recode Yes/No to 1/0
yes_no_vars <- c(
"entrance",
"triage",
"medical doctor",
"laboratory",
"dispensing pharmacy",
"radiolohgy",
"rights respected?",
"waiting",
"cashier"
)
analytic.data <- analytic.data %>%
mutate(across(all_of(yes_no_vars),
~ case_when(
. == "Yes" ~ 1,
. == "No"  ~ 0,
TRUE       ~ NA_real_
)))
analytic.data <- analytic.data %>%
mutate(
Province = recode(Province,
"Eastern"      = 1,
"Kigali City"  = 2,
"Northern"     = 3,
"Southern"     = 4,
"Western"      = 5) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
visits = recode(visits,
"new"        = 1,
"returning" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
AgeCategory = recode(AgeCategory,
"young" = 1,
"Adult" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
Hospitalgrp = recode(Hospitalgrp,
"District"     = 1,
"higherRanked" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
location = recode(location,
"rural" = 1,
"urban" = 2) |> as.numeric()
)
analytic.data <- analytic.data %>%
mutate(
Gender = recode(Gender,
"Male"   = 1,
"Female" = 2) |> as.numeric()
)
MOD1 <- glm(waiting ~ location, family = "binomial", data = DatasetNew)
MOD1 <- glm(waiting ~ location, family = "binomial", data = analytic.data)
summary(MOD1)
exp(confint(MOD1))
MOD1 <- glm(waiting ~ location, family = "binomial", data = analytic.data)
summary(MOD1)
exp(MOD1)
###location#
MOD1 <- glm(waiting ~ location, family = "binomial", data = analytic.data)
summary(MOD1)
# Odds ratios
exp(coef(MOD1))
# 95% CI on log-odds scale, then exponentiate to get OR CI
confint(MOD1)           # log-odds scale
exp(confint(MOD1))      # odds ratio scale
library(broom)
tidy(MOD1, exponentiate = TRUE, conf.int = TRUE)
###location#
MOD1 <- glm(waiting ~ location, family = "binomial", data = analytic.data)
summary(MOD1)
# Odds ratios
exp(coef(MOD1))
exp(confint(MOD1))      # odds ratio scale
